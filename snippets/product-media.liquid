{{ 'component-deffered-media.css' | asset_url | stylesheet_tag }}

{% liquid
  assign settings_page_width = settings.max_page_width | append: 'px'
  if settings.max_page_width == 'full_width'
    assign settings_page_width = '100vw'
  endif
%}

{% if style == 'slideshow' %}
  <li id="Slide-{{ section.id }}-zoom" class="slider__grid-item {% if settings.enable_blending %}enable-blending{% endif %} snap-align card-js {% if style == 'slideshow' and section.settings.enable_slideshow_zoom_in %} container-magnify-hover{% endif %}
    {% if for_loop.first or first %}is-active{% endif %} 
    {% if for_loop.last and settings.show_lines and for_loop.length >= 1 %}last-desktop{% endif %} 
    {% if for_loop.last and settings.show_lines and for_loop.length >= 1 %}last-mobile{% endif %}
    {% if product_media.size == 1 %}last-element{% endif %}">
{% endif %}
{%- if media.media_type == 'image' -%}
{% if settings.images_loading != 'disable' %}
    <figure class="lazy-image {% if image_ratio == 'original' %}ratio-original{% endif %} lazy-image--{{ settings.images_loading }}" style="--desktop-asp-rat: {{ media.preview_image.aspect_ratio }}">
{% endif %}
  <img
    class="global-media-settings product-modal-image {% if image_ratio != 'original' %}ratio-{{ image_ratio }}{% endif %} global-media-settings--no-shadow {% if variant_image %}product__media-item--variant{% endif %}{% if current_variant_alt %} product__media-item--variant--alt{% endif %}{% unless hide_images %} product__media-item--variant-show{% endunless %}{% if media.media_type != 'image' or general_media %} product__media-item--show product__media-item--variant-alt product__media-item--full{% endif %} {% if product.selected_or_first_available_variant.featured_media == blank %} product__media-item--show{% endif %}
    {% if style == 'slideshow' and section.settings.enable_slideshow_zoom_in %} image-magnify-hover{% endif %}"
    srcset="{%- if media.preview_image.width >= 550 -%}{{ media.preview_image | image_url: width: 550 }} 550w,{%- endif -%}
            {%- if media.preview_image.width >= 1100 -%}{{ media.preview_image | image_url: width: 1100 }} 1100w,{%- endif -%}
            {%- if media.preview_image.width >= 1445 -%}{{ media.preview_image | image_url: width: 1445 }} 1445w,{%- endif -%}
            {%- if media.preview_image.width >= 1680 -%}{{ media.preview_image | image_url: width: 1680 }} 1680w,{%- endif -%}
            {%- if media.preview_image.width >= 2048 -%}{{ media.preview_image | image_url: width: 2048 }} 2048w,{%- endif -%}
            {%- if media.preview_image.width >= 2200 -%}{{ media.preview_image | image_url: width: 2200 }} 2200w,{%- endif -%}
            {%- if media.preview_image.width >= 2890 -%}{{ media.preview_image | image_url: width: 2890 }} 2890w,{%- endif -%}
            {%- if media.preview_image.width >= 4096 -%}{{ media.preview_image | image_url: width: 4096 }} 4096w,{%- endif -%}
            {{ media.preview_image | image_url }} {{ media.preview_image.width }}w"
    
    sizes="(max-width: 920px) {{ section.settings.mobile_width }}vw, {{ section.settings.desktop_width }}vw"
    src="{{ media.preview_image | image_url: width: 1445 }}"
    alt="{{ media.alt | escape }}"
    loading="lazy"
    {% if settings.images_loading != 'disable' %}
      onload="this.parentNode.classList.add('lazyloaded');"
    {% endif %}
    draggable="false"
    width="1100"
    height="{{ 1100 | divided_by: media.preview_image.aspect_ratio | ceil }}"
    {% if image_ratio == 'original' %}style="aspect-ratio: {{ media.preview_image.aspect_ratio }};"{% endif %}
    data-media-id="{{ media.id }}"
    data-media-alt="{{ media_alt }}"
    {% if settings.disable_right_click %}oncontextmenu="return false"{% endif %}
  >
  {% if settings.images_loading != 'disable' %}
    {% if settings.images_loading != 'fade_scale' %}
    <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true">
        <img 
        alt="{{ media.preview_image.alt | escape }}" 
        src="{{ media.preview_image | image_url: width: 10 }}"
        draggable="false"
        width="10" 
        height="10">
    </div>
    {% endif %}
    </figure>
{% endif %}
    {% if style == 'slideshow' and section.settings.enable_slideshow_zoom_in %}
      <div class="image-zoom-icon zoom">
        {%- liquid 
          if settings.typography_preset == 'avant_garde'
              assign weight = settings.accent_icon_weight
              if settings.swap_fonts
                  assign weight = settings.base_icon_weight
              endif
          else 
              assign weight =  settings.base_icon_weight
              if settings.swap_fonts
                  assign weight = settings.accent_icon_weight
              endif
          endif
          if settings.typography_preset == 'custom'
                assign weight = settings.custom_icon_weight
          endif
        -%}
        <div class="icon-zoom-in">
          {% if weight == 'regular' %}
            {% render 'icon-accordion-2', icon: 'zoom-in-regular' %}
        {% elsif weight == 'medium' %}
            {% render 'icon-accordion-2', icon: 'zoom-in-medium' %}
        {% elsif weight == 'bold' %}
            {% render 'icon-accordion-2', icon: 'zoom-in-bold' %}
        {% endif %}
        </div>
        <div class="icon-zoom-out">
          {% if weight == 'regular' %}
              {% render 'icon-accordion-2', icon: 'zoom-out-regular' %}
          {% elsif weight == 'medium' %}
              {% render 'icon-accordion-2', icon: 'zoom-out-medium' %}
          {% elsif weight == 'bold' %}
              {% render 'icon-accordion-2', icon: 'zoom-out-bold' %}
          {% endif %}
        </div>
      </div>
      {% endif %}
{%- else -%}
  {%- if media.media_type == 'model' -%}
    <div class="product-media-modal__model" data-media-id="{{ media.id }}">
      <product-model class="deferred-media {% if settings.enable_blending %}enable-blending{% endif %} product__media-item ratio-{{ image_ratio }} media media--transparent global-media-settings global-media-settings--no-shadow" 
        style="{% if image_ratio == 'original' %}aspect-ratio: {{ media.preview_image.aspect_ratio }};{% endif %} padding-top: min(calc(100vh - 12rem), 100%)">
  {%- else -%}
    <deferred-media class="deferred-media {% if settings.enable_blending %}enable-blending{% endif %} product__media-item ratio-{{ image_ratio }} media global-media-settings global-media-settings--no-shadow" 
      style="{% if image_ratio == 'original' %}aspect-ratio: {{ media.preview_image.aspect_ratio }};{% endif %} padding-top: min(calc(100vh - 12rem), {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%)" 
      data-media-id="{{ media.id }}" 
      data-enable-autoplay="{{ autoplay }}">
  {%- endif -%}

    <button id="Deferred-Poster-Modal-{{ media.id }}" class="deferred-media__poster {% if image_ratio != 'original' %}ratio-{{ image_ratio }}{% endif %}" {% if image_ratio == 'original' %}style="aspect-ratio: {{ media.preview_image.aspect_ratio }};"{% endif %} type="button" aria-label="{{ 'products.product.media.play_media' | t }}">
      <span class="deferred-media__poster-button motion-reduce">
        {%- liquid 
          if settings.typography_preset == 'avant_garde'
              assign weight = settings.accent_icon_weight
              if settings.swap_fonts
                  assign weight = settings.base_icon_weight
              endif
          else 
              assign weight =  settings.base_icon_weight
              if settings.swap_fonts
                  assign weight = settings.accent_icon_weight
              endif
          endif
          if settings.typography_preset == 'custom'
                assign weight = settings.custom_icon_weight
          endif
        -%}
        {%- if media.media_type == 'model' -%}
            <svg width="26" height="29" viewBox="0 0 26 29" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.0376 28.7532C12.6775 29.1045 13.4579 29.0792 14.0738 28.6873L25.0738 21.6873C25.6506 21.3202 26 20.6838 26 20V7.55469C26 6.83786 25.6164 6.17585 24.9944 5.81944C24.3725 5.46302 23.6074 5.4667 22.9889 5.82909L21.8751 6.48169L11.9889 12.2744C11.3764 12.6333 11 13.2901 11 14V25.8215V27C11 27.73 11.3977 28.4019 12.0376 28.7532Z"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 7.55556V20.5185L11 25.8215L13 27V14.037L24 7.55469L21.8751 6.48169L13 2L2 7.55556ZM15 15.18L24 9.87692L25.0153 9.27868C25.6454 8.90739 26.0226 8.22177 25.999 7.49079C25.9753 6.7598 25.5545 6.10004 24.9016 5.77032L13.9016 0.214767C13.3346 -0.0715889 12.6654 -0.0715889 12.0984 0.214767L1.09837 5.77032C0.424763 6.11053 0 6.80092 0 7.55556V20.5185C0 21.2267 0.374532 21.8821 0.984692 22.2416L11.9847 28.7231C12.603 29.0875 13.3692 29.0926 13.9923 28.7365C14.6154 28.3804 15 27.7177 15 27V25.7273V15.18Z"/>
            </svg>          
        {%- else -%}
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.0077 3.75446C8.67441 2.97671 7 3.93846 7 5.48203V26.5179C7 28.0615 8.67445 29.0232 10.0078 28.2454L28.0385 17.7272C29.3615 16.9555 29.3615 15.0439 28.0385 14.2721L10.0077 3.75446Z"/>
          </svg>
        {%- endif -%}
      </span>
      {% if settings.images_loading != 'disable' %}
        <figure class="lazy-image {% if image_ratio == 'original' %}ratio-original{% endif %} lazy-image--{{ settings.images_loading }}" style="--desktop-asp-rat: {{ media.preview_image.aspect_ratio }}">
      {% endif %}
      <img
        srcset="{% if media.preview_image.width >= 288 %}{{ media.preview_image | image_url: width: 288 }} 288w,{% endif %}
                {% if media.preview_image.width >= 600 %}{{ media.preview_image | image_url: width: 600 }} 600w,{% endif %}
                {% if media.preview_image.width >= 713 %}{{ media.preview_image | image_url: width: 713 }} 713w,{% endif %}
                {% if media.preview_image.width >= 823 %}{{ media.preview_image | image_url: width: 823 }} 823w,{% endif %}
                {% if media.preview_image.width >= 990 %}{{ media.preview_image | image_url: width: 990 }} 990w,{% endif %}
                {% if media.preview_image.width >= 1100 %}{{ media.preview_image | image_url: width: 1100 }} 1100w,{% endif %}
                {% if media.preview_image.width >= 1206 %}{{ media.preview_image | image_url: width: 1206 }} 1206w,{% endif %}
                {% if media.preview_image.width >= 1346 %}{{ media.preview_image | image_url: width: 1346 }} 1346w,{% endif %}
                {% if media.preview_image.width >= 1426 %}{{ media.preview_image | image_url: width: 1426 }} 1426w,{% endif %}
                {% if media.preview_image.width >= 1646 %}{{ media.preview_image | image_url: width: 1646 }} 1646w,{% endif %}
                {% if media.preview_image.width >= 1946 %}{{ media.preview_image | image_url: width: 1946 }} 1946w,{% endif %}
                {{ media.preview_image | image_url }} {{ media.preview_image.width }}w"
        src="{{ media | image_url: width: 550, height: 550 }}"
        sizes="(max-width: 920px) {{ section.settings.mobile_width }}vw, {{ section.settings.desktop_width }}vw"
        loading="lazy"
        {% if settings.images_loading != 'disable' %}
          onload="this.parentNode.classList.add('lazyloaded');"
        {% endif %}
        draggable="false"
        width="576"
        height="{{ 576 | divided_by: media.preview_image.aspect_ratio }}"
        alt="{{ media.preview_image.alt | escape }}"
        {% if settings.disable_right_click %}oncontextmenu="return false"{% endif %}
      >
      {% if settings.images_loading != 'disable' %}
        {% if settings.images_loading != 'fade_scale' %}
        <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true">
            <img 
            alt="{{ media.preview_image.alt | escape }}" 
            src="{{ media.preview_image | image_url: width: 10 }}"
            draggable="false"
            width="10" 
            height="10">
        </div>
        {% endif %}
        </figure>
    {% endif %}
    </button>
    <template>
      {%- case media.media_type -%}
      {%- when 'external_video' -%}
        {%- assign video_class = 'js-' | append: media.host -%}
        {%- if media.host == 'youtube' -%}
          {{ media | external_video_url: autoplay: true, loop: loop, controls: controls | external_video_tag: class: video_class, loading: "lazy", id: media.external_id }}
        {%- else -%}
          {{ media | external_video_url: autoplay: true, loop: loop, muted: autoplay, controls: controls | external_video_tag: class: video_class, loading: "lazy" }}
        {%- endif -%}
      {%- when 'video' -%}
        {% if settings.images_loading == 'disable' %}
          {{ media | media_tag: image_size: "2048x", autoplay: true, loop: loop, muted: autoplay, controls: controls, preload: "none" }}
        {% else %}
            <figure class="lazy-video lazy-image lazy-image--{{ settings.images_loading }}" style="--desktop-asp-rat: {{ media.aspect_ratio }}">
                {{ media | media_tag:  image_size: "2048x", autoplay: true, loop: loop, muted: autoplay, controls: controls, preload: "none", oncanplay: 'this.parentNode.classList.add("lazyloaded");' }}
                {% if settings.images_loading != 'fade_scale' %}
                <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true" >
                    <img 
                        alt="{{ media.alt | escape }}" 
                        src="{{ media.preview_image | image_url: width: 10 }}"
                        draggable="false"
                        width="10" 
                        height="10"
                    >
                </div>
                {% endif %}
            </figure>
        {% endif %}
      {%- when 'model' -%}
        {{ media | media_tag: image_size: "2048x", toggleable: true }}
      {%- endcase -%}
    </template>

  {%- if media.media_type == 'model' -%}
      </product-model>
      <button
        class="button button--full-width product__xr-button outlined-button button--{{ settings.typography_preset }} {% if settings.typography_preset == 'custom' %}{% if settings.regular_button_size == 'default' %}button-font--default{% else %}{{ settings.regular_button_size }}{% endif %}{% endif %}"
        type="button"
        aria-label="{{ 'products.product.xr_button_label' | t }}"
        data-shopify-xr
        data-shopify-model3d-id="{{ media.id }}"
        data-shopify-title="title"
        data-shopify-xr-hidden
        >
        {{ 'products.product.xr_button' | t }}
      </button>
    </div>
  {%- else -%}
    </deferred-media>
  {%- endif -%}
{%- endif -%}
{% if style == 'slideshow' %}
  </li>
{% endif %}
