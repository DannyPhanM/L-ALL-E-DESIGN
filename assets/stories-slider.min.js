/**
 * UI Initiative Stories Slider 1.0.0
 *
 * Instagram-like Stories Slider Made With Swiper
 *
 * https://uiinitiative.com
 *
 * Copyright 2022-2024 UI Initiative
 *
 * Released under the UI Initiative Regular License
 *
 * Released on: September 12, 2024
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).createStoriesSlider=t()}(this,(function(){"use strict";return function(e,t={}){const i=e.querySelector(".swiper"),{autoplayDuration:s=5e3,Swiper:r,EffectCube:n,Virtual:o,virtual:l,onSlidesIndexesChange:a,onAutoplayStart:d,onAutoplayStop:c,onEnd:u}=t;let p,m,{enabled:v=!0}=t,f=0;const h=[];let y,b,g,E,q,S,w,T,A;const x=e=>void 0===e?l||void 0!==o:e.virtual&&e.params.virtual.enabled,L=(e,t)=>x(e)?e.slides.find((e=>e.getAttribute("data-swiper-slide-index")===String(t))):e.slides[t],I=(e,t)=>{const i=h.indexOf(e);if(-1===i)return 0;let r=void 0===t?s:t;const n=L(e,e.activeIndex);let o=n&&parseInt(n.getAttribute("data-duration"),10);const l=n&&n.querySelector("video");return Number.isNaN(o)&&l&&(o=1e3*l.duration),!Number.isNaN(o)&&o>0&&void 0===t&&(r=o),w=r,e.storiesSliderAutoplayTimeout=setTimeout((()=>{if(e.isEnd){if(f!==i)return;p.isEnd?u&&u():p.slideNext()}else e.slideNext()}),r),d&&d(e),r},N=e=>{m=requestAnimationFrame((()=>{const t=e&&e.parentElement&&e.parentElement.parentElement;if(e.play(),t)if(e.paused){H();const i=document.createElement("div");i.classList.add("stories-slider-play-button"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fff"><path d="m380-300 280-180-280-180v360ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',t.append(i),i.addEventListener("click",(()=>{i.remove(),e.play(),Z()}))}else{const e=t.querySelector(".stories-slider-play-button");e&&e.remove()}}))},F=e=>{clearTimeout(e.storiesSliderAutoplayTimeout),c&&c(e)},C=e=>{F(e);const t=L(e,e.activeIndex),i=t&&t.querySelector("video");i&&(cancelAnimationFrame(m),i.pause());const r=w||s;let n=t&&parseInt(t.getAttribute("data-duration"),10);if(Number.isNaN(n)&&(n=void 0),!n&&i&&(n=1e3*i.duration),w=r-((new Date).getTime()-S),e.isEnd&&w<0)return;w<0&&(w=0);const o=1-w/(n||s),l=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`);l.querySelector("span").remove(),l.insertAdjacentHTML("beforeend",`<span style="transform:translateX(${100*o-100}%)"></span>`)},D=e=>{if(e.isEnd&&w<0)return;S=(new Date).getTime(),I(e,w);const t=L(e,e.activeIndex),i=t&&t.querySelector("video");if(i)try{N(i)}catch(e){}const s=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1}) > span`);s.style.transform="translateX(0%)",s.style.transitionDuration=`${w}ms`},M=e=>{F(e),I(e),S=(new Date).getTime(),$(e.el,e);const t=e.el.querySelector(".stories-slider-pagination-bullet-current");t&&t.classList.remove("stories-slider-pagination-bullet-current");const i=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`),s=L(e,e.activeIndex),r=s&&s.querySelector("video");if(cancelAnimationFrame(m),r){r.currentTime=0;try{N(r)}catch(e){}}e.slides.forEach((e=>{e.querySelectorAll("video").forEach((e=>{e!==r&&(e.currentTime=0,r||cancelAnimationFrame(m),e.pause())}))})),h.filter(((e,t)=>t!==f)).forEach((e=>{e.el.querySelectorAll("video").forEach((e=>{r||cancelAnimationFrame(m),e.pause()}))}));const n=[...i.parentElement.children],o=[...n].filter(((e,t)=>t<n.indexOf(i))),l=[...n].filter(((e,t)=>t>n.indexOf(i)));o.forEach((e=>{e.classList.add("stories-slider-pagination-bullet-viewed"),e.querySelectorAll("span").forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend","<span></span>")})),l.forEach((e=>{e.classList.remove("stories-slider-pagination-bullet-viewed","stories-slider-pagination-bullet-current"),e.querySelectorAll("span").forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend","<span></span>")})),i.classList.remove("stories-slider-pagination-bullet-viewed"),i.classList.add("stories-slider-pagination-bullet-current"),[...i.children].forEach((e=>e.remove())),i.insertAdjacentHTML("beforeend","<span></span>"),i.clientWidth,i.querySelector("span").style.transform="translateX(0%)",i.querySelector("span").style.transitionDuration=`${w}ms`,a&&(cancelAnimationFrame(y),y=requestAnimationFrame((()=>{a(f,e.activeIndex)})))},$=(e,t)=>{e.querySelectorAll(".swiper-slide").forEach((e=>{if(e.querySelector(".stories-slider-button-prev"))return;const i=document.createElement("div"),s=document.createElement("div");i.classList.add("stories-slider-button","stories-slider-button-prev"),s.classList.add("stories-slider-button","stories-slider-button-next"),e.appendChild(i),e.appendChild(s);i.addEventListener("click",(()=>{q>200||(t.isBeginning?p.slidePrev():t.slidePrev())})),s.addEventListener("click",(()=>{q>200||(t.isEnd?p.slideNext():t.slideNext())}))}))},j=()=>{e.querySelectorAll(".swiper .swiper").forEach(((e,t)=>{if(t=x()?parseInt(e.closest(".swiper-slide").getAttribute("data-swiper-slide-index"),10):t,e.swiper)return;const i=new window.Swiper(e,{modules:void 0!==o?[o]:[],speed:1,nested:!0,allowTouchMove:!1,observer:!0,virtual:x(),on:{touchStart(e){A||(b=!0,T=!1,g=(new Date).getTime(),E=setTimeout((()=>{T=!0,C(e)}),200))},touchEnd(e){A||(clearTimeout(E),f===t&&b&&(q=(new Date).getTime()-g,T&&D(e),T=!1,b=!1))},init(e){v&&(f!==t?F(e):requestAnimationFrame((()=>{M(e)})))},slideChange(e){A=!1,M(e)}}});((e,t)=>{const i=t&&x(t)?t.virtual.slides.length:t?t.slides.length:e.querySelectorAll(".swiper-slide").length,s=document.createElement("div");s.classList.add("stories-slider-pagination");for(let e=0;e<i;e+=1){const e=document.createElement("div");e.classList.add("stories-slider-pagination-bullet"),e.appendChild(document.createElement("span")),s.appendChild(e)}e.appendChild(s)})(e,i),$(e,i),h[t]=i}))};(()=>{const t=()=>{e.classList.add("stories-slider-perspective")},s=()=>{e.classList.remove("stories-slider-perspective")},r=[];void 0!==o&&r.push(o),void 0!==n&&r.push(n),p=new window.Swiper(i,{modules:r,effect:"cube",speed:500,threshold:5,cubeEffect:{shadow:!1},observer:!0,virtual:x(),on:{transitionStart(){s(),e.classList.add("stories-slider-animating")},sliderFirstMove(){s()},transitionEnd(){t(),e.classList.remove("stories-slider-animating")},init(e){e.params.resistanceRatio=.5,t()},slideChange(){j(),A=!1;const e=h[f];f=p.activeIndex;const t=h[f];F(e),I(t),M(t)}}})})(),j();const H=(e=!1)=>{A=!!e,C(h[f])},Z=()=>{A=!1,D(h[f])};return{el:e,mainSwiper:p,subSwipers:h,destroy:()=>{p&&p.destroy&&p.destroy(),h.forEach((e=>{F(e),e.el.querySelectorAll(".stories-slider-pagination, .stories-slider-pagination-bullet").forEach((e=>e.remove())),(e=>{e.el.querySelectorAll(".stories-slider-button").forEach((e=>e.remove()))})(e),e.destroy&&e.destroy()}))},slideTo:(e,t)=>{if(p&&p.slideTo&&!p.destroyed&&p.slideTo(e,0),void 0!==t){const i=h[e];i.slideTo&&!i.destroyed&&(i.activeIndex===t?M(i):i.slideTo(t,0))}},enable:()=>{v||h.forEach(((e,t)=>{t===f&&M(e)}))},disable:()=>{v=!1,h.forEach(((e,t)=>{e.el.querySelectorAll("video").forEach((e=>{cancelAnimationFrame(m),e.pause()})),t===f?C(e):F(e)}))},pause:H,resume:Z}}}));
//# sourceMappingURL=stories-slider.min.js.map